-- ===============================
-- ROBLOX BRAINROT SCANNER V9.0 ULTRA FAST
-- ‚ö° MAXIMUM SPEED - NO DELAYS
-- ===============================

if not game:IsLoaded() then game.Loaded:Wait() end
repeat task.wait() until game:GetService("Players").LocalPlayer

local workspace = game:GetService('Workspace')
local Players = game:GetService('Players')
local TeleportService = game:GetService('TeleportService')
local HttpService = game:GetService('HttpService')
local CoreGui = game:GetService('CoreGui')
local Lighting = game:GetService('Lighting')
local RunService = game:GetService('RunService')

-- ===============================
-- KONFIGURATION - ULTRA SPEED
-- ===============================
local VPS_URL = "https://roblox-brainrot-scanner.therixyt4.workers.dev/api"
local API_SECRET = "123"
local VPS_PLACE_ID = 109983668079237
local MIN_GENERATION = 10
local USERNAME = Players.LocalPlayer.Name

-- ‚ö° ULTRA FAST SETTINGS
local WAIT_FOR_LOAD = 2       -- 5 -> 2 seconds
local SCAN_TIME = 1.5         -- 4 -> 1.5 seconds  
local HOP_DELAY = 3.5         -- 9 -> 3.5 seconds TOTAL

local SPECIAL_WEBHOOK = "https://ptb.discord.com/api/webhooks/1466088189260468458/Vi19cPhLJXGckt_0IDjRa6MkGixFznByJ_0BlNmKx0h84VlBgJtrPmtHWmbDHiW3eOPe"
local SPECIAL_MIN_GEN = 200
local SPECIAL_BRAINROTS = {
    ["garama and madundung"] = true, ["la casa boo"] = true, ["festive 67"] = true,
    ["la ginger sekolah"] = true, ["ketchuru and musturu"] = true, ["la taco combinasion"] = true,
    ["spaghetti aualetti"] = true, ["tang tang keletang"] = true, ["la secret combinasion"] = true,
    ["chillin chili"] = true, ["lavadorito spinito"] = true, ["celularcini viciosini"] = true,
    ["tralaledon"] = true, ["ketupat kepat"] = true, ["tictac sahur"] = true,
    ["fragrama and chocrama"] = true
}

local http_request = (syn and syn.request) or (http and http.request) or http_request or (fluxus and fluxus.request) or request
if not http_request then error("‚ùå ERROR: No HTTP support!") end

-- ===============================
-- MINIMAL UI - NO LAG
-- ===============================
local function createFastUI()
    local sg = Instance.new("ScreenGui")
    sg.Name = "LuxarFast"
    sg.IgnoreGuiInset = true
    sg.DisplayOrder = 999999999
    sg.ResetOnSpawn = false
    pcall(function() sg.Parent = CoreGui end)
    if not sg.Parent then sg.Parent = Players.LocalPlayer:WaitForChild("PlayerGui") end
    
    local bg = Instance.new("Frame")
    bg.Size = UDim2.new(1, 0, 1, 0)
    bg.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    bg.BorderSizePixel = 0
    bg.Parent = sg
    
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 80)
    title.Position = UDim2.new(0, 0, 0.5, -40)
    title.BackgroundTransparency = 1
    title.Text = "‚ö° ULTRA FAST V9.0"
    title.TextColor3 = Color3.fromRGB(40, 40, 40)
    title.TextSize = 60
    title.Font = Enum.Font.GothamBold
    title.Parent = bg
    
    local status = Instance.new("TextLabel")
    status.Size = UDim2.new(1, 0, 0, 25)
    status.Position = UDim2.new(0, 0, 0.5, 50)
    status.BackgroundTransparency = 1
    status.Text = "Loading..."
    status.TextColor3 = Color3.fromRGB(100, 100, 100)
    status.TextSize = 16
    status.Font = Enum.Font.Gotham
    status.Parent = bg
    
    return sg, status
end

local whiteScreenGui, statusLabel = createFastUI()
local function updateStatus(text)
    if statusLabel then statusLabel.Text = text end
end

-- ===============================
-- EXTREME PERFORMANCE BOOST
-- ===============================
if setfpscap then setfpscap(10) end  -- Lower FPS = faster
pcall(function() RunService:Set3dRenderingEnabled(false) end)
pcall(function() Lighting.GlobalShadows = false Lighting.Brightness = 0 Lighting.FogEnd = 1 end)
pcall(function() for _, e in ipairs(Lighting:GetChildren()) do if e:IsA("PostEffect") or e:IsA("Atmosphere") or e:IsA("Sky") then e:Destroy() end end end)

-- ===============================
-- ULTRA FAST FUNCTIONS
-- ===============================
local function parseMoneyPerSec(text)
    if not text or not text:find("/s") then return 0 end
    text = text:gsub("%$",""):gsub("/s",""):gsub("%s+","")
    local multiplier = text:find("[Bb]") and 1e9 or text:find("[Mm]") and 1e6 or text:find("[Kk]") and 1e3 or text:find("[Tt]") and 1e12 or 1
    text = text:gsub("[KkMmBbTt]","")
    return tonumber(text) and tonumber(text) * multiplier or 0
end

local function getUsernameFromDisplayName(displayName)
    for _, player in pairs(Players:GetPlayers()) do
        if player.DisplayName == displayName or player.Name == displayName then return player.Name end
    end
    return nil
end

local function getUsernameFromPlot(plot)
    local success, result = pcall(function()
        if plot:FindFirstChild('Owner') then
            local owner = plot.Owner
            if owner:IsA('StringValue') then return owner.Value end
            if owner:IsA('ObjectValue') and owner.Value then return owner.Value.Name end
        end
        return plot:GetAttribute('Owner') or plot:GetAttribute('OwnerName') or 
               (plot:FindFirstChild('OwnerName') and plot.OwnerName:IsA('StringValue') and plot.OwnerName.Value) or nil
    end)
    return success and result or nil
end

local function getPlotOwnerInfo(plotId)
    local success, result = pcall(function()
        local plot = workspace.Plots:FindFirstChild(plotId)
        if not plot then return nil end
        local plotSign = plot:FindFirstChild("PlotSign")
        if plotSign then
            local surfaceGui = plotSign:FindFirstChild("SurfaceGui")
            if surfaceGui then
                local frame = surfaceGui:FindFirstChild("Frame")
                if frame then
                    local textLabel = frame:FindFirstChild("TextLabel")
                    if textLabel and textLabel.Text ~= "" then
                        local displayName = textLabel.Text:gsub("'s [Bb]ase", ""):gsub("'s [Pp]lot", ""):match("^%s*(.-)%s*$")
                        if displayName ~= "" then
                            return getUsernameFromDisplayName(displayName) or getUsernameFromPlot(plot) or displayName
                        end
                    end
                end
            end
        end
        return getUsernameFromPlot(plot)
    end)
    return success and result or nil
end

local function findOwnerForBrainrot(brainrotObj)
    local current = brainrotObj.Parent
    while current and current ~= workspace do
        if current.Parent and current.Parent.Name == "Plots" then
            return getPlotOwnerInfo(current.Name) or "Unknown"
        end
        current = current.Parent
    end
    return "Unknown"
end

-- ‚ö° ULTRA FAST SCANNER - NO DELAYS
local function scanAllBrainrots()
    local detections = {}
    local descendants = workspace:GetDescendants()
    local batchSize = 100  -- Bigger batches = faster
    
    print("üîç Starting scan... (" .. #descendants .. " objects)")
    
    for i = 1, #descendants, batchSize do
        local batchEnd = math.min(i + batchSize - 1, #descendants)
        for j = i, batchEnd do
            local obj = descendants[j]
            if obj:IsA("TextLabel") and obj.Name == "Generation" then
                local moneyValue = parseMoneyPerSec(obj.Text)
                local moneyM = moneyValue / 1e6
                if moneyM >= MIN_GENERATION then
                    local parent = obj.Parent
                    local name = (parent and parent:FindFirstChild("DisplayName") and parent.DisplayName.Text) or "Unknown"
                    local owner = findOwnerForBrainrot(obj)
                    
                    print("üß† Found: " .. name .. " - " .. obj.Text .. " - Owner: " .. owner)
                    
                    table.insert(detections, {
                        name = name,
                        generation = obj.Text,
                        owner = owner,
                        genNum = moneyM
                    })
                end
            end
        end
        -- NO DELAYS! Keep scanning
    end
    
    table.sort(detections, function(a, b) return a.genNum > b.genNum end)
    print("üìä Scan complete! Found " .. #detections .. " brainrots")
    return detections
end

local function scanAllHighlights()
    local highlights = {}
    pcall(function()
        local plotsFolder = workspace:FindFirstChild("Plots")
        if not plotsFolder then return end
        for _, plot in ipairs(plotsFolder:GetChildren()) do
            if plot.Name:match("^Plot%d+$") then
                local highlight = plot:FindFirstChild("Highlight", true)
                if highlight and highlight:IsA("Highlight") then
                    table.insert(highlights, {
                        owner = getPlotOwnerInfo(plot.Name) or "Unknown",
                        plotId = plot.Name
                    })
                end
            end
        end
    end)
    return highlights
end

-- ‚ö° INSTANT API SEND - NO WAIT
local function sendToAPI(brainrots, highlights, serverId)
    if #brainrots == 0 and #highlights == 0 then return end
    task.spawn(function()
        pcall(function()
            local filteredBrainrots = {}
            for _, br in ipairs(brainrots) do
                local genNum = br.genNum or (parseMoneyPerSec(br.generation) / 1e6)
                if genNum >= MIN_GENERATION then
                    table.insert(filteredBrainrots, {
                        generation = br.generation,
                        owner = br.owner,
                        plotId = "Unknown"
                    })
                end
            end
            
            if #filteredBrainrots == 0 and #highlights == 0 then return end
            
            http_request({
                Url = VPS_URL .. "/submit",
                Method = "POST",
                Headers = {
                    ["Content-Type"] = "application/json",
                    ["X-API-Secret"] = API_SECRET
                },
                Body = HttpService:JSONEncode({
                    serverId = serverId,
                    playerCount = #Players:GetPlayers(),
                    maxPlayers = Players.MaxPlayers,
                    worker = USERNAME,
                    brainrots = filteredBrainrots,
                    highlights = highlights
                })
            })
        end)
    end)
end

-- ‚ö° INSTANT WEBHOOK - NO WAIT
local function sendToSpecialWebhook(eligibleBrainrots, serverId)
    if #eligibleBrainrots == 0 then 
        print("‚ö†Ô∏è No special brainrots to send to webhook")
        return 
    end
    if SPECIAL_WEBHOOK == "" then 
        print("‚ö†Ô∏è Webhook URL is empty")
        return 
    end
    
    print("üî• Sending " .. #eligibleBrainrots .. " special brainrots to webhook!")
    
    task.spawn(function()
        pcall(function()
            local titleParts = {}
            for _, br in ipairs(eligibleBrainrots) do
                local title = br.name .. " " .. br.generation
                print("   üìå " .. title)
                table.insert(titleParts, title)
            end
            
            local payload = {
                embeds = {{
                    title = table.concat(titleParts, " | "),
                    description = "**Server ID**\n```" .. serverId .. "```",
                    color = 16776960,
                    footer = { text = "Worker: " .. USERNAME },
                    timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ")
                }}
            }
            
            print("üì§ Sending webhook...")
            local response = http_request({
                Url = SPECIAL_WEBHOOK,
                Method = "POST",
                Headers = {["Content-Type"] = "application/json"},
                Body = HttpService:JSONEncode(payload)
            })
            
            if response and response.StatusCode then
                print("‚úÖ Webhook sent! Status: " .. response.StatusCode)
            else
                print("‚ùå Webhook failed - no response")
            end
        end)
    end)
end

-- ===============================
-- ‚ö° ULTRA FAST SERVER HOPPING
-- ===============================
local serverQueue = {}
local lastAPICall = 0

local function fetchServersToQueue()
    if tick() - lastAPICall < 30 then return end  -- Faster refresh
    task.spawn(function()
        pcall(function()
            lastAPICall = tick()
            local response = http_request({
                Url = "https://games.roblox.com/v1/games/" .. tostring(VPS_PLACE_ID) .. "/servers/Public?limit=100",
                Method = "GET",
                Headers = {
                    ["User-Agent"] = "Roblox/WinInet",
                    ["Accept"] = "application/json"
                }
            })
            if response and response.StatusCode == 200 then
                local data = HttpService:JSONDecode(response.Body)
                if data and data.data then
                    serverQueue = {}
                    for _, server in ipairs(data.data) do
                        if server.id and server.id ~= game.JobId then
                            table.insert(serverQueue, server.id)
                        end
                    end
                end
            end
        end)
    end)
end

local function hopToNextServer()
    if #serverQueue > 0 then
        local serverId = table.remove(serverQueue, 1)
        pcall(function()
            TeleportService:TeleportToPlaceInstance(VPS_PLACE_ID, serverId, Players.LocalPlayer)
        end)
        return true
    end
    pcall(function()
        TeleportService:Teleport(VPS_PLACE_ID, Players.LocalPlayer)
    end)
    return true
end

-- ===============================
-- ‚ö° MAIN ULTRA FAST LOOP
-- ===============================
local totalScanned = 0
local scanInProgress = false

local function performFastScan()
    if scanInProgress then return end
    scanInProgress = true
    
    local serverId = game.JobId
    
    -- Phase 1: Wait for full game load
    updateStatus("Waiting for game...")
    local loadStartTime = tick()
    local gameLoaded = false
    
    -- Wait for Plots folder to exist AND have plots in it
    repeat 
        if tick() - loadStartTime > WAIT_FOR_LOAD then
            updateStatus("Load timeout, hopping...")
            scanInProgress = false
            return
        end
        task.wait(0.1)
        
        -- Check if game is actually loaded
        if workspace:FindFirstChild("Plots") then
            local plotsFolder = workspace.Plots
            local plotCount = 0
            for _, child in pairs(plotsFolder:GetChildren()) do
                if child.Name:match("^Plot%d+$") then
                    plotCount = plotCount + 1
                end
            end
            
            -- Game is loaded if we have at least some plots
            if plotCount > 0 then
                gameLoaded = true
                print("‚úÖ Game loaded! Found " .. plotCount .. " plots")
                break
            end
        end
    until gameLoaded
    
    -- Extra wait to ensure everything is loaded
    updateStatus("Game loaded, waiting...")
    task.wait(0.5)
    
    -- Phase 2: INSTANT SCAN
    updateStatus("‚ö° Scanning...")
    
    local brainrots = scanAllBrainrots()
    local highlights = scanAllHighlights()
    totalScanned = totalScanned + 1
    
    if #brainrots > 0 or #highlights > 0 then
        updateStatus(string.format("‚úÖ %d brainrots + %d highlights!", #brainrots, #highlights))
        
        print("=" .. string.rep("=", 50))
        print("üìä SCAN RESULTS:")
        print("   Total Brainrots: " .. #brainrots)
        print("   Total Highlights: " .. #highlights)
        
        -- Send INSTANTLY - no wait
        sendToAPI(brainrots, highlights, serverId)
        
        -- Send special to Discord
        print("\nüîç Checking for SPECIAL brainrots...")
        local specialBrainrots = {}
        for _, br in ipairs(brainrots) do
            local genNum = br.genNum or (parseMoneyPerSec(br.generation) / 1e6)
            local nameNorm = (br.name or ""):lower()
            
            print("   Checking: " .. br.name .. " (" .. br.generation .. ")")
            print("      GenNum: " .. genNum .. "M")
            print("      Name normalized: " .. nameNorm)
            print("      Is in list: " .. tostring(SPECIAL_BRAINROTS[nameNorm] or false))
            print("      Gen >= " .. SPECIAL_MIN_GEN .. ": " .. tostring(genNum >= SPECIAL_MIN_GEN))
            
            if SPECIAL_BRAINROTS[nameNorm] or genNum >= SPECIAL_MIN_GEN then
                print("      ‚úÖ SPECIAL BRAINROT DETECTED!")
                table.insert(specialBrainrots, br)
            end
        end
        
        print("\nüî• Total SPECIAL brainrots: " .. #specialBrainrots)
        
        if #specialBrainrots > 0 then
            sendToSpecialWebhook(specialBrainrots, serverId)
        else
            print("‚ö†Ô∏è No special brainrots matched criteria")
        end
        print("=" .. string.rep("=", 50))
    else
        updateStatus(string.format("Nothing (Scanned: %d)", totalScanned))
    end
    
    scanInProgress = false
end

-- ===============================
-- ‚ö° AUTO HOP - ULTRA FAST
-- ===============================
print("‚ö° ULTRA FAST V9.0 LOADED!")
print("‚ö° Hop every " .. HOP_DELAY .. " seconds!")

-- Fetch servers in background
task.spawn(function()
    while true do
        fetchServersToQueue()
        task.wait(30)
    end
end)

-- MAIN FAST LOOP
task.spawn(function()
    while true do
        performFastScan()
        
        -- Quick countdown
        local remaining = HOP_DELAY - WAIT_FOR_LOAD - SCAN_TIME
        if remaining > 0 then
            task.wait(remaining)
        end
        
        updateStatus("‚ö° Hopping...")
        hopToNextServer()
        task.wait(0.5)  -- Minimal delay
    end
end)

TeleportService.TeleportInitFailed:Connect(function()
    updateStatus("Hop failed, retry...")
    scanInProgress = false
    hopToNextServer()
end)

print("‚ö° RUNNING AT MAXIMUM SPEED!")
